/* -----  Editor basics  ---------------------------------------------------- */

.k-markdown-input .CodeMirror {
  #{--line-padding}: 4px;
  height: auto;
  padding: .25rem .5rem;

  .cm-invisibles-test { 
  	color: #de935f; 
  }

  /**
   * Set placeholder color
   */
  &-placeholder {
    color: #999999;
  }

  .CodeMirror-scroll {
    overflow: auto;
  }

  /* Editor content */

  /**
   * Default style for every line.
   */
  pre {
    padding: 0 var(--line-padding);
  }

  /**
   * 1. Needed to keep tabs before nested list items from
   *    collapsing.
   */
  .cm-tab {
    width: 4ch; /* 1 */
  }

  /* Selected text */

  .CodeMirror-selected {
    background-color: rgba($color-focus, .2);
  }

  .CodeMirror-selectedtext {
    color: $color-dark;
  }

  /* Cursor */

  .CodeMirror-cursor {
    border-left: 2px solid $color-focus;
  }

}

/* -----  Shared text formatting -------------------------------------------- */

.k-markdown-input {

  .CodeMirror {
    font-variant-numeric: tabular-nums;
  }

  .cm-comment {
    background: darken(#fafafa, 2%);
    color: black;
  }

  /**
   * 1. Reset color of headings to match text color.
   */
  .cm-header {
    color: inherit; /* 1 */
  }

  /* Horizontal rule */

  .cm-blockhr {
    display: flex;

    span {
      flex-grow: 0;
      padding-left: 1ch;
      padding-right: 1ch;
    }

    &::before,
    &::after {
      $c: rgba($color-border, .5);
      background: linear-gradient($c, $c) 50% calc(50% + 1px) / 100% 1px no-repeat;
      content: '';
      flex-grow: 1;
    }
  }

  /* Markdown link */
  
  .cm-link {
    color: inherit;
    text-decoration: none;
  }

  .cm-formatting-link.cm-link,
  .cm-formatting-link-string.cm-url,
  .cm-string.cm-url {
    color: $color-dark-grey;
  }

  .cm-formatting.cm-formatting-link-string.cm-string.cm-url + .cm-url {
    text-decoration: underline;
  }

  /* Code */
  
  .cm-code {
    background: rgba($color-dark, .05);
  }

  .cm-blockcode {
    background: rgba($color-dark, .05);
  }

  .cm-blockcode .cm-code {
    background: transparent;
  }

  /* Blockquote */

  .cm-blockquote .cm-quote {
    color: inherit;
  }

  /* HTML tags */
  
  .cm-tag {
    color: $color-dark-grey;
  }

  .cm-attribute {
    color: $color-dark-grey;
  }

  .cm-string {
    color: $color-dark;
  }

}

/* -----  Kirbytext mode  --------------------------------------------------- */

.k-markdown-input {
  .cm-kirbytag {
    padding: .0625em 0;
    margin: -.125empx -.0625em;
    border-radius: .125em;
    background: rgba($color-focus, .15);
    border: .0625em solid rgba($color-focus, .3);
    box-decoration-break: clone;
  }
}

/* -----  Monospace font  --------------------------------------------------- */

.k-markdown-input[font="monospace"] .CodeMirror {
  font-family: $font-family-mono;
  line-height: 1.75;

  /* Headings & Blockquotes */

  .cm-header {
    font: inherit;
    font-weight: 700;
  }

  .cm-blockheader,
  .cm-blockquote,
  .cm-blocklist {
    padding-left: calc(var(--line-padding) + 1ch * (var(--cm-block-indent, 0)));
    text-indent: calc(-1ch * (var(--cm-block-indent, 0)));
  }
}

/* -----  Sans-serif font  -------------------------------------------------- */

.k-markdown-input[font="sans-serif"] .CodeMirror {
  font-family: $font-family-sans;
  line-height: 1.5;

  .cm-header,
  .cm-header ~ * {
    font: inherit;
    font-weight: 700;
  }

  .cm-header-1,
  .cm-header-1 ~ * {
    font-size: 30px;
    line-height: 1.25;
  }
  
  .cm-header-2,
  .cm-header-2 ~ * {
    font-size: 24px;
    line-height: 1.4;
  }
  
  .cm-header-3,
  .cm-header-3 ~ * {
    font-size: 20px;
    line-height: 1.5;
  }

  .cm-header-4,
  .cm-header-4 ~ * {
    font-size: 18px;
  }

  .cm-header-5,
  .cm-header-5 ~ * {
    font-size: 16px;
  }

  .cm-header-6,
  .cm-header-6 ~ * {
    font-size: 14px;
  }

  .cm-blockheader,
  .cm-blockquote,
  .cm-blocklist {
    padding-left: calc(var(--line-padding) + 1px * (var(--cm-block-indent, 0)));
    text-indent: calc(-1px * (var(--cm-block-indent, 0)));
  }

  .cm-blockcode,
  .cm-code {
    font-family: $font-family-mono;
    font-size: (14px / 16px * 1rem);
    line-height: (1.5 * 16px / 14px);
  }

  .cm-blockhr {
    font-family: $font-family-mono;
  }
}
